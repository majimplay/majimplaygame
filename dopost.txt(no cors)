function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);

    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName('usuarios');

    const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn())
                       .getValues()[0];
    const colIndex = {};
    headers.forEach((titulo, i) => {
      colIndex[titulo] = i + 1;
    });

    const nextRow = sheet.getLastRow() + 1;
    
    // Correção: usar os valores reais do objeto data
    const novo = {
      'Nome':     data.name,
      'E-mail':   data.email,
      'FotoURL':  data.picture,
      'Timestamp': new Date(),
      'GoogleID': data.id
    };

    Object.keys(novo).forEach(campo => {
      const col = colIndex[campo];
      if (col) {
        // Correção: remover ponto e vírgula entre métodos encadeados
        sheet.getRange(nextRow, col)
             .setValue(novo[campo])
             .setBorder(true, true, true, true, true, true, '#000000', SpreadsheetApp.BorderStyle.SOLID_MEDIUM);
      } else {
        // Correção: remover 'opcional:' inválido
        Logger.log(`Coluna "${campo}" não existe!`);
      }
    });

    return ContentService
      .createTextOutput(JSON.stringify({ status: 'success', message: 'Data saved to sheet.' }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    Logger.log(error);
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'error', message: error.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
